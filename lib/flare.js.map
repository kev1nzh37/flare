{"version":3,"file":"flare.min.js.map","sources":["../src/until/index.ts","../src/error-observer.ts","../src/report.ts","../src/onerror.ts","../src/init.ts","../src/index.ts"],"sourcesContent":["import { ErrorType, OneErrorTypeMap } from '../interface'\n\nconst oneErrorTypeMap: OneErrorTypeMap = {\n  referenceError: 'Uncaught ReferenceError',\n  typeError: 'Uncaught TypeError',\n  rangeError: 'Uncaught TypeError'\n}\n\nexport const isObj = (obj: any): boolean => {\n  return typeof obj === 'object' && !!obj\n}\n\nexport const isWindow = (): boolean => {\n  return window !== undefined\n}\n\nexport const getOnerrorType = (message: string): ErrorType => {\n  const typeKey: string | undefined = Object.keys(oneErrorTypeMap).find((i) =>\n    message.startsWith(oneErrorTypeMap[i])\n  )\n\n  return (typeKey as ErrorType) || 'unknownError'\n}\n\n","import { ErrObj, ErrorListener } from './interface'\n\nconst errorListRef = []\nlet errorListenr: null | ErrorListener = null\n\n\nexport function addError (errObj: ErrObj): void {\n  errorListRef.push(errObj)\n  doChange('add', errObj)\n}\n\nexport const initListenr = (callback: ErrorListener): void => {\n  errorListenr = callback\n}\nexport function resetError (): void {\n  doChange('reset')\n}\n\nfunction doChange (method: string, errObj?: ErrObj): void {\n  if (errorListenr) errorListenr(method, errObj)\n}\n","import { ReportSub } from './interface'\nimport { initListenr } from './error-observer'\n\nlet _onReport: ReportSub = sendErrReport\n\n/**\n * init send service, if not have onReport, use default method\n * @param {ReportSub} onReport error callback\n **/\nexport function initSendErrReport(onReport: ReportSub): void {\n  if (onReport) _onReport = onReport\n  watchTheError()\n}\n\n/**\n * default send error method\n * @param {string} errJsonData\n **/\nfunction sendErrReport(errJsonData: string): void {\n  console.log(errJsonData)\n}\n\n/**\n * listen error observer\n **/\nfunction watchTheError(): void {\n  initListenr((method, errObj) => {\n    console.log('监听errlist, 获得消息了', method, errObj)\n\n    if (method === 'add' && errObj !== null) {\n      _onReport(JSON.stringify(errObj))\n    }\n  })\n}\n","import { addError } from './error-observer'\nimport { ErrObj, NetworkOrSrcEventTarget } from './interface'\nimport { getOnerrorType } from './until'\nlet INITONERROR = false\n/**\n * init all of error event\n **/\nfunction installOneError(): void {\n  if (INITONERROR) {\n    throw new Error('onerror is inited.')\n  }\n\n  addOneErrorEvent()\n  addPromiseEvent()\n  addNetworkOrSrcEvent()\n\n  INITONERROR = true\n}\n\n/**\n * check network reject or src reject\n **/\nfunction addNetworkOrSrcEvent() {\n  window.addEventListener(\n    'error',\n    (error: Event) => {\n      console.log('捕获到异常：', error)\n\n      const { tagName, src, href } = error.target as NetworkOrSrcEventTarget\n      const path = error.composedPath().map((value) => {\n        const { nodeName } = value as HTMLElement\n        return nodeName || 'Window'\n      })\n      if (\n        tagName !== undefined &&\n        ['IMG', 'LINK', 'SCRIPT'].includes(tagName)\n      ) {\n        const networkOrSrcParams: ErrObj = {\n          url: window.location.href,\n          type: 'resourceError',\n          srcUrl: src || href,\n          tagName,\n          path\n        }\n\n        console.log(path)\n        computedErrorObject(networkOrSrcParams)\n      }\n      return true\n    },\n    true\n  )\n}\n\n/**\n * check onerror callback of error\n **/\nfunction addOneErrorEvent() {\n  window.onerror = (message, url, lineNo, columnNo, errorObj) => {\n    console.log(message, url, lineNo, columnNo, errorObj)\n    const oneErrorParams: ErrObj = {\n      message: errorObj?.message || message,\n      lineNo,\n      columnNo,\n      url,\n      type: getOnerrorType(message as string)\n    }\n\n    computedErrorObject(oneErrorParams)\n  }\n}\n\n/**\n * check promise reject\n **/\nfunction addPromiseEvent() {\n  window.addEventListener(\n    'unhandledrejection',\n    (error) => {\n      console.log('捕获到异常：', error)\n\n      //       const { tagName, src, href } = error.target as NetworkOrSrcEventTarget\n      //       if (\n      //         tagName !== undefined &&\n      //         ['IMG', 'LINK', 'SCRIPT'].includes(tagName)\n      //       ) {\n      //         const networkOrSrcParams: ErrObj = {\n      //           url: window.location.href,\n      //           type: 'resourceError',\n      //           srcUrl: src || href,\n      //           tagName\n      //         }\n      //         computedErrorObject(networkOrSrcParams)\n      //       }\n      return true\n    },\n    true\n  )\n}\n\n/**\n * get all error and add\n * @param {OneErrorParams} oneErrorParams  error data from event\n **/\nfunction computedErrorObject(oneErrorParams: ErrObj) {\n  //.....\n  console.log(oneErrorParams)\n  const errObj = Object.assign({}, oneErrorParams, {\n    id: 11\n  })\n  addError(errObj)\n}\n\nexport const initOneError = (): void => installOneError()\n","import { Config, InitObj } from './interface'\nimport { isObj, isWindow } from './until'\nimport { initSendErrReport } from './report'\nimport { initOneError } from './onerror'\n\nexport function init(initObj: InitObj): void {\n  const { config, onReport } = initObj\n\n  if (!isWindow()) {\n    throw new Error('not in web')\n  }\n\n  if (isObj(config) && isWindow) {\n    const { locationHref } = config\n    _config.locationHref = locationHref || window.location.href\n  }\n\n  initSendErrReport(onReport)\n  initOneError()\n}\n\nexport const _config: Config = {\n  auto: false,\n  locationHref: undefined\n}\n","import { Flare } from './interface/index'\nimport { init } from './init'\n\nconst flare: Flare = {\n  init\n}\n\nexport { flare }\n"],"names":[],"mappings":"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"}